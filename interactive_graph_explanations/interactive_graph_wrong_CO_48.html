<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSM8K Math Problem Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            background-color: #F5F5F5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .left-panel {
            width: 30%;
            background: white;
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #ddd;
        }

        .right-panel {
            width: 70%;
            background: #F5F5F5;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .problem-statement {
            margin-bottom: 30px;
        }

        .problem-statement p {
            font-size: 16px;
            line-height: 1.6;
            color: #34495e;
        }

        .problem-understanding {
            margin-bottom: 20px;
        }

        .problem-understanding ul {
            list-style-type: disc;
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .problem-understanding li {
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 8px;
            color: #34495e;
        }

        .highlight-number-1 { background-color: #ff634780; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-2 { background-color: #87cefa80; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-3 { background-color: #90ee9080; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-4 { background-color: #ffa50080; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-5 { background-color: #d3a0d380; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-6 { background-color: #ffd90080; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-7 { background-color: #4682b480; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-8 { background-color: #228b2280; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-9 { background-color: #ffc0cb80; padding: 2px 6px; border-radius: 5px; color: black; }
        .highlight-number-10 { background-color: #dc143c80; padding: 2px 6px; border-radius: 5px; color: black; }

        .debugger-controls {
            background-color: #f8f9fa;
            padding: 10px;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #ddd;
        }

        .debugger-controls button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            color: white;
            transition: all 0.2s ease;
        }

        .btn-play-pause {
            background-color: #2ecc71;
            color: white;
        }
        .btn-stop {
            background-color: #e74c3c;
            color: white;
        }
        .btn-prev, .btn-next {
            background-color: #3498db;
            color: white;
        }

        .debugger-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .graph-container {
            flex: 1;
            position: relative;
            background: white;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        #math-graph {
            width: 100%;
            height: 70%;
        }

        #step-iframe {
            width: 100%;
            height: 30%;
            border: none;
            border-top: 1px solid #ddd;
            background: white;
        }

        .math-node {
            cursor: grab;
            transition: all 0.3s ease;
        }

        .math-node:active {
            cursor: grabbing;
        }

        .math-node.highlighted .node-bg {
            stroke-width: 4;
            filter: drop-shadow(0 6px 16px rgba(255, 215, 0, 0.6));
            stroke: #ffd700;
        }
        .wrong-step {
            display: none;
        }
        .math-node .math-eq {
            display:none;
        }

        .math-node:hover .math-eq {
            display:block;
        }

    </style>
</head>
<body>
    <div class="wrong-step">6</div>
    <div class="container">
        <div class="left-panel">
            <div class="problem-statement">
                <div class="section-title">Problem Statement</div>
                <p>In a week, <span id="fact1" class="highlight-number-1">450 cars drove through a toll booth</span>. <span id="fact2" class="highlight-number-2">Fifty vehicles went through the toll booth on Monday</span> and the same number of vehicles drove through the toll booth on Tuesday. On each of Wednesday and Thursday, <span id="fact3" class="highlight-number-3">twice the number of cars that passed through the toll booth on Monday</span> went through the toll booth. If, for the remaining of the days of the week, an equal number of vehicles passed through the toll booth, calculate the total number of cars that passed the toll booth in each of the remaining days.</p>
            </div>

            <div class="problem-understanding">
                <div class="section-title">Problem Summary</div>
                <ul>
                    <li><span class="highlight-number-1">Total cars in a week: 450</span></li>
                    <li><span class="highlight-number-2">Cars on Monday: 50</span></li>
                    <li><span class="highlight-number-3">Cars on Wednesday and Thursday: 2 times Monday's cars</span></li>
                </ul>
                <div><strong>Goal:</strong> Calculate the total number of cars that passed the toll booth in each of the remaining days.</div>
            </div>
        </div>

        <div class="right-panel">
            <div class="debugger-controls">
                <button class="btn btn-play-pause" id="playPauseBtn">▶ Play</button>
                <button class="btn btn-stop" id="stopBtn">■ Stop</button>
                <button class="btn btn-prev" id="prevBtn">⤴ Previous Step</button>
                <button class="btn btn-next" id="nextBtn">⤵ Next Step</button>
            </div>

            <div class="graph-container" id="graph-container">
                <svg id="math-graph" width="100%" height="100%" viewBox="0 0 800 480">
                    <defs>
                        <marker id="arrowhead" markerWidth="4" markerHeight="3" refX="4" refY="1.5" orient="auto">
                            <polygon points="0 0, 4 1.5, 0 3" fill="black" />
                        </marker>
                    </defs>
                </svg>
                <iframe id="step-iframe" srcdoc="<div style='padding: 20px; font-family: Arial, sans-serif;'>Click Play to start the visualization</div>"></iframe>
            </div>
        </div>
    </div>

    <script>
        const baseNodes = {
            totalCars: { id: 'total-cars', x: 100, y: 100, label: 'Total Cars', value: '450 cars', calc: '450', color: 'rgba(255, 99, 71, 0.5)' },
            mondayCars: { id: 'monday-cars', x: 100, y: 200, label: 'Monday Cars', value: '50 cars', calc: '50', color: 'rgba(135, 206, 250, 0.5)' },
            tuesdayCars: { id: 'tuesday-cars', x: 100, y: 400, label: 'Tuesday Cars', value: '50 cars', calc: '50', color: '#D3D3D3' },
            mondayTuesdayTotal: { id: 'monday-tuesday-total', x: 300, y: 200, label: 'Monday-Tuesday Total', value: '100 cars', calc: '50 + 50 = 100', color: 'rgba(70, 130, 180, 0.5)' },
            wednesdayCars: { id: 'wednesday-cars', x: 300, y: 300, label: 'Wednesday Cars', value: '100 cars', calc: '2 × 50 = 100', color: 'rgba(144, 238, 144, 0.5)' },
            thursdayCars: { id: 'thursday-cars', x: 300, y: 400, label: 'Thursday Cars', value: '100 cars', calc: '2 × 50 = 100', color: '#D3D3D3' },
            wednesdayThursdayTotal: { id: 'wednesday-thursday-total', x: 500, y: 300, label: 'Wednesday-Thursday Total', value: '200 cars', calc: '100 + 100 = 200', color: 'rgba(255, 165, 0, 0.5)' },
            mondayToThursdayTotal: { id: 'monday-to-thursday-total', x: 700, y: 200, label: 'Monday-Thursday Total', value: '300 cars', calc: '200 + 100 = 300', color: 'rgba(221, 160, 221, 0.5)' },
            remainingDaysTotal: { id: 'remaining-days-total', x: 700, y: 300, label: 'Remaining Days Total', value: '150 cars', calc: '450 - 300 = 150', color: 'rgba(255, 215, 0, 0.5)' },
            eachRemainingDay: { id: 'each-remaining-day', x: 700, y: 400, label: 'Each Remaining Day', value: '75 cars', calc: '150 ÷ 2 = 75', color: 'rgba(255, 192, 203, 0.5)' }
        };

        const problemData = {
            totalSteps: 6,
            getSteps: () => [
                {
                    explanation: "Calculate the total number of cars that went through the toll booth on Monday and Tuesday",
                    calculation: "Monday cars + Tuesday cars = 50 + 50 = 100 cars",
                    nodes: [
                        { ...baseNodes.mondayCars, isNew: true },
                        { ...baseNodes.tuesdayCars, isNew: true },
                        { ...baseNodes.mondayTuesdayTotal, isNew: true }
                    ],
                    connections: [
                        { from: 'monday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'tuesday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' }
                    ]
                },
                {
                    explanation: "Calculate the number of cars that went through the toll booth on Wednesday",
                    calculation: "2 × Monday cars = 2 × 50 = 100 cars",
                    nodes: [
                        baseNodes.mondayCars,
                        baseNodes.tuesdayCars,
                        baseNodes.mondayTuesdayTotal,
                        { ...baseNodes.wednesdayCars, isNew: true }
                    ],
                    connections: [
                        { from: 'monday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'tuesday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-cars', to: 'wednesday-cars', operation: '×', label: '2', color: '#D3D3D3' }
                    ]
                },
                {
                    explanation: "Calculate the total number of cars that went through the toll booth on Wednesday and Thursday",
                    calculation: "Wednesday cars + Thursday cars = 100 + 100 = 200 cars",
                    nodes: [
                        baseNodes.mondayCars,
                        baseNodes.tuesdayCars,
                        baseNodes.mondayTuesdayTotal,
                        baseNodes.wednesdayCars,
                        { ...baseNodes.thursdayCars, isNew: true },
                        { ...baseNodes.wednesdayThursdayTotal, isNew: true }
                    ],
                    connections: [
                        { from: 'monday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'tuesday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-cars', to: 'wednesday-cars', operation: '×', label: '2', color: '#D3D3D3' },
                        { from: 'wednesday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'thursday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' }
                    ]
                },
                {
                    explanation: "Calculate the total number of cars that passed through the toll booth from Monday to Thursday",
                    calculation: "Monday-Tuesday total + Wednesday-Thursday total = 200 + 100 = 300 cars",
                    nodes: [
                        baseNodes.mondayCars,
                        baseNodes.tuesdayCars,
                        baseNodes.mondayTuesdayTotal,
                        baseNodes.wednesdayCars,
                        baseNodes.thursdayCars,
                        baseNodes.wednesdayThursdayTotal,
                        { ...baseNodes.mondayToThursdayTotal, isNew: true }
                    ],
                    connections: [
                        { from: 'monday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'tuesday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-cars', to: 'wednesday-cars', operation: '×', label: '2', color: '#D3D3D3' },
                        { from: 'wednesday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'thursday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'wednesday-thursday-total', to: 'monday-to-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-tuesday-total', to: 'monday-to-thursday-total', operation: '+', color: '#D3D3D3' }
                    ]
                },
                {
                    explanation: "Calculate the number of cars that went through the toll booth on the remaining days",
                    calculation: "Total cars - Monday to Thursday total = 450 - 300 = 150 cars",
                    nodes: [
                        { ...baseNodes.totalCars, isNew: true },
                        baseNodes.mondayCars,
                        baseNodes.tuesdayCars,
                        baseNodes.mondayTuesdayTotal,
                        baseNodes.wednesdayCars,
                        baseNodes.thursdayCars,
                        baseNodes.wednesdayThursdayTotal,
                        baseNodes.mondayToThursdayTotal,
                        { ...baseNodes.remainingDaysTotal, isNew: true }
                    ],
                    connections: [
                        { from: 'monday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'tuesday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-cars', to: 'wednesday-cars', operation: '×', label: '2', color: '#D3D3D3' },
                        { from: 'wednesday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'thursday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'wednesday-thursday-total', to: 'monday-to-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-tuesday-total', to: 'monday-to-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'total-cars', to: 'remaining-days-total', operation: '-', color: '#D3D3D3' },
                        { from: 'monday-to-thursday-total', to: 'remaining-days-total', operation: '-', color: '#D3D3D3' }
                    ]
                },
                {
                    explanation: "Calculate the number of cars that went through the toll booth on each of the remaining days",
                    calculation: "Remaining days total ÷ Number of remaining days = 150 ÷ 2 = 75 cars",
                    nodes: [
                        baseNodes.totalCars,
                        baseNodes.mondayCars,
                        baseNodes.tuesdayCars,
                        baseNodes.mondayTuesdayTotal,
                        baseNodes.wednesdayCars,
                        baseNodes.thursdayCars,
                        baseNodes.wednesdayThursdayTotal,
                        baseNodes.mondayToThursdayTotal,
                        baseNodes.remainingDaysTotal,
                        { ...baseNodes.eachRemainingDay, isNew: true }
                    ],
                    connections: [
                        { from: 'monday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'tuesday-cars', to: 'monday-tuesday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-cars', to: 'wednesday-cars', operation: '×', label: '2', color: '#D3D3D3' },
                        { from: 'wednesday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'thursday-cars', to: 'wednesday-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'wednesday-thursday-total', to: 'monday-to-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'monday-tuesday-total', to: 'monday-to-thursday-total', operation: '+', color: '#D3D3D3' },
                        { from: 'total-cars', to: 'remaining-days-total', operation: '-', color: '#D3D3D3' },
                        { from: 'monday-to-thursday-total', to: 'remaining-days-total', operation: '-', color: '#D3D3D3' },
                        { from: 'remaining-days-total', to: 'each-remaining-day', operation: '÷', label: '2', color: '#D3D3D3' }
                    ]
                }
            ]
        };
        let currentStep = 1;
        let isPlaying = false;
        let playInterval = null;
        let draggedNode = null;
        let nodePositions = {};
        let formulaOverlay = null;
        let isDragging = false;

        const svg = document.getElementById('math-graph');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const stepIframe = document.getElementById('step-iframe');

        function initializeVisualization() {
            updateVisualization();
            updateButtons();
        }

        function updateVisualization() {
            const steps = problemData.getSteps();
            const step = steps[currentStep - 1];
            // Clear SVG
            while (svg.children.length > 1) {
                svg.removeChild(svg.lastChild);
            }
            // Draw connections first
            step.connections.forEach(conn => {
                drawConnection(conn, step.nodes);
            });
            // Draw nodes
            step.nodes.forEach(node => {
                drawNode(node);
            });
            // Update step display
            updateStepDisplay();
        }

       function drawNode(node) {
        const pos = nodePositions[node.id] || { x: node.x, y: node.y };
        const make = (tag, attrs, text) => {
            const el = document.createElementNS('http://www.w3.org/2000/svg', tag);
            Object.entries(attrs).forEach(([k, v]) => el.setAttribute(k, v));
            if (text) el.textContent = text;
            return el;
        };

        const group = make('g', { 'data-node-id': node.id });
        group.classList.add('math-node');
        // Listen for prevBtn clicks

       const rect = make('rect', {
            x: pos.x - 60, y: pos.y - 35, width: 120, height: 70, rx: 8,
            fill: node.color, 'fill-opacity': 1, stroke: node.color, 'stroke-width': 2,
            class: 'node-bg'
        });

        const label = make('text', {
            x: pos.x, y: pos.y - 15, 'text-anchor': 'middle',
            'dominant-baseline': 'central', 'font-size': 12,
            'font-weight': 'bold', fill: '#1e293b'
        }, node.label);

        const value = make('text', {
            x: pos.x, y: pos.y + 5, 'text-anchor': 'middle',
            'dominant-baseline': 'central', 'font-size': 14,
            'font-weight': 'bold', fill: '#1e293b'
        }, node.value);

        const calc = make('text', {
            x: pos.x, y: pos.y + 20, 'text-anchor': 'middle',
            'dominant-baseline': 'central', 'font-size': 12,
            fill: '#6b7280'
        }, `(${node.calc})`);

        // Add class to the last text element
        calc.classList.add('math-eq');

        group.append(rect, label, value, calc);


        group.addEventListener('mousedown', e => startDrag(e, node));
        group.addEventListener('mouseenter', () => highlightDependencies(node.id));
        group.addEventListener('mouseleave', clearHighlights);

        svg.appendChild(group);

        if (node.isNew && !isDragging) {
            group.style.transform = 'scale(0)';
            group.style.transformOrigin = `${pos.x}px ${pos.y}px`;
            setTimeout(() => {
            group.style.transition = 'transform 0.5s ease';
            group.style.transform = 'scale(1)';
            }, 100);
        }
        }

       function drawConnection(conn, nodes) {
        const from = nodes.find(n => n.id === conn.from);
        const to = nodes.find(n => n.id === conn.to);
        if (!from || !to) return;

        const p = id => nodePositions[id] || { x: nodes.find(n => n.id === id).x, y: nodes.find(n => n.id === id).y };
        const [f, t] = [p(from.id), p(to.id)];
        [sx, sy, ex, ey] = [f.x + 60, f.y, t.x - 60, t.y];

        if (f.x > t.x){
            [sx, sy, ex, ey] = [f.x - 60, f.y, t.x + 60, t.y];
        }
        if ((Math.abs(f.x - t.x)<=120) ) {
            [sx, sy, ex, ey] = [f.x, f.y + 35, t.x, t.y - 35]
            if (f.y > t.y) {
                [sx, sy, ex, ey] = [f.x, f.y - 35, t.x, t.y + 35]
            }
            
        }
        const [mx, my] = [(sx + ex) / 2, (sy + ey) / 2];

        const makeEl = (tag, attrs, text) => {
            const el = document.createElementNS('http://www.w3.org/2000/svg', tag);
            Object.entries(attrs).forEach(([k, v]) => el.setAttribute(k, v));
            if (text) el.textContent = text;
            svg.appendChild(el);
        };

        makeEl('path', { d: `M ${sx} ${sy} Q ${mx} ${my} ${ex} ${ey}`, stroke: conn.color, 'stroke-opacity': 1, 'stroke-width': 3, fill: "none", 'marker-end': 'url(#arrowhead)' });
        makeEl('rect', { x: mx - 25, y: my - 12, width: 50, height: 24, rx: 10, fill: conn.color });
        makeEl('text', { x: mx, y: my, 'text-anchor': 'middle', 'dominant-baseline': 'central', 'font-size': 12, 'font-weight': 'bold', fill: 'black' }, conn.operation + (conn.label ? ' ' + conn.label : ''));
        }


        function updateStepDisplay() {
            const steps = problemData.getSteps();
            const step = steps[currentStep - 1];
            
            let content = `
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <div style="background: #FFF3CD; border-left: 3px solid #FFC107; padding: 15px; border-radius: 5px; display: flex;">
                        <div>
                         ${step.explanation}
                         <br></br>
                        <strong>Calculation:</strong> ${step.calculation} 
                        </div>
                        <span style = "color:#adadad; font-size:1.7rem; font-weight:700; padding:2px 10px; border-radius:14px; pointer-events:nonex;margin-left:auto;">${currentStep}</span>
                    </div>
                   
                </div>
            `

            if (currentStep === problemData.totalSteps) {
                content += `
                    <div style="padding: 0 20px 20px 20px;">
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <strong>Final Answer:</strong> The total number of cars that passed the toll booth in each of the remaining days is 75 cars.
                        </div>
                    </div>
                `;
            }

            stepIframe.srcdoc = content;
        }

        function startDrag(e, node) {
            isDragging = false;
            draggedNode = node;
            const startX = e.clientX;
            const startY = e.clientY;
            const startPos = nodePositions[node.id] || { x: node.x, y: node.y };

            function onMouseMove(e) {
                if (!isDragging && (Math.abs(e.clientX - startX) > 5 || Math.abs(e.clientY - startY) > 5)) {
                    isDragging = true;
                }
                if (isDragging) {
                    const rect = svg.getBoundingClientRect();
                    const scaleX = 800 / rect.width;
                    const scaleY = 480 / rect.height;
                    
                    nodePositions[node.id] = {
                        x: Math.max(-10, Math.min(810, startPos.x + (e.clientX - startX) * scaleX)),
                        y: Math.max(40, Math.min(440, startPos.y + (e.clientY - startY) * scaleY))
                    };
                updateVisualization();
                }
            }

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                
                setTimeout(() => { isDragging = false; }, 100);
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        }

        function highlightDependencies(nodeId) {
            const nodes = document.querySelectorAll('.math-node');
            nodes.forEach(node => {
                if (node.getAttribute('data-node-id') === nodeId) {
                    node.classList.add('highlighted');
                }
            });
        }

        function clearHighlights() {
            const nodes = document.querySelectorAll('.math-node');
            nodes.forEach(node => {
                node.classList.remove('highlighted');
            });
        }

        function play() {
            if (isPlaying) return;
            isPlaying = true;
            playPauseBtn.textContent = 'Pause';
            
            playInterval = setInterval(() => {
                if (currentStep < problemData.totalSteps) {
                    nextStep();
                } else {
                    stop();
                }
            }, 2000);
        }

        function pause() {
            if (!isPlaying) return;
            isPlaying = false;
            playPauseBtn.textContent = 'Play';
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }

        function stop() {
            pause();
            currentStep = 1;
            updateVisualization();
            updateButtons();
        }

        function nextStep() {
            if (currentStep < problemData.totalSteps) {
                currentStep++;
                updateVisualization();
                updateButtons();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateVisualization();
                updateButtons();
            }
        }

        function updateButtons() {
            prevBtn.disabled = currentStep === 1;
            nextBtn.disabled = currentStep === problemData.totalSteps;
            
            if (isPlaying) {
                playPauseBtn.textContent = 'Pause';
            } else {
                playPauseBtn.textContent = 'Play';
            }
        }

        // Event listeners
        playPauseBtn.addEventListener('click', () => {
            if (isPlaying) {
                pause();
            } else {
                play();
            }
        });

        stopBtn.addEventListener('click', stop);
        prevBtn.addEventListener('click', prevStep);
        nextBtn.addEventListener('click', nextStep);

        // Initialize
        initializeVisualization();
    </script>
</body>
</html>